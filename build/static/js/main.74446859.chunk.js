(this["webpackJsonplogseq-plugin-markdown-table"]=this["webpackJsonplogseq-plugin-markdown-table"]||[]).push([[0],{111:function(e,t,n){},191:function(e,t,n){},192:function(e,t,n){"use strict";n.r(t);n(84);var r=n(0),o=n.n(r),i=n(17),a=n.n(i),c=(n(110),n(111),n(112),n(57)),l=n(2),s=n(11),u=n(1),d=n(34),b=function(e){var t=e.deleteBackward,n=e.deleteForward,r=e.insertBreak;return e.deleteBackward=function(n){var r=e.selection;if(r){var o=u.a.nodes(e,{match:function(e){return!u.a.isEditor(e)&&u.b.isElement(e)&&"table-cell"===e.type}}),i=Object(l.a)(o,1)[0],a=u.a.before(e,r),c=u.a.nodes(e,{at:a,match:function(e){return!u.a.isEditor(e)&&u.b.isElement&&"table-cell"===e.type}}),s=Object(l.a)(c,1)[0];if(i){var d=Object(l.a)(i,2)[1],b=u.a.start(e,d);if(u.e.equals(r.anchor,b))return}if(!i&&s)return}t(n)},e.deleteForward=function(t){var r=e.selection;if(r&&u.f.isCollapsed(r)){var o=u.a.nodes(e,{match:function(e){return!u.a.isEditor(e)&&u.b.isElement(e)&&"table-cell"===e.type}}),i=Object(l.a)(o,1)[0],a=u.a.after(e,r),c=u.a.nodes(e,{at:a,match:function(e){return!u.a.isEditor(e)&&u.b.isElement&&"table-cell"===e.type}}),s=Object(l.a)(c,1)[0];if(i){var d=Object(l.a)(i,2)[1],b=u.a.end(e,d);if(u.e.equals(r.anchor,b))return}if(!i&&s)return}n(t)},e.insertBreak=function(){if(e.selection){var t=u.a.nodes(e,{match:function(e){return!u.a.isEditor(e)&&u.b.isElement(e)&&"table"===e.type}});if(Object(l.a)(t,1)[0])return}r()},e},f=(n(114),n(30)),h=n(196),j=n(197),m=n(198),p=n(199),w=n(200),O=n(201),v=n(13),x=n(40),y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.trim().split("\n").filter(Boolean),n=[t[0]].concat(t.slice(2)),r=n.map((function(e){var t=e.trim().split("|");return t.slice(1,t.length-1)}));return k(r)},g=function(e){return{type:"table-cell",children:[{text:e}]}},k=function(e){var t=Array.from(e,(function(e){return function(e){return{type:"table-row",children:Array.from(e,(function(e){return g(e)}))}}(e)}));return{type:"table",children:t}},A=function e(t){var n=this;Object(x.a)(this,e),this.insertTable=function(e,t){var r=u.a.nodes(n.editor,{match:function(e){return!u.a.isEditor(e)&&u.b.isElement(e)&&"table"===e.type},mode:"highest"});if(!Object(l.a)(r,1)[0]&&e&&t){var o=Array.from({length:e},(function(){return Array.from({length:t},(function(){return""}))})),i=k(o);u.h.insertNodes(n.editor,i,{mode:"highest"}),u.h.insertNodes(n.editor,{type:"paragraph",children:[{text:""}]},{mode:"highest"})}},this.insertCells=function(e,t,r,o){var i,a=r.anchor,c={row:null===a||void 0===a?void 0:a.path[1],column:null===a||void 0===a?void 0:a.path[2]};console.log("[faiz:] === selection",r);var l=Array.from(e.children,(function(e){return Array.from(e.children,(function(e){return e.children[0].text}))})),d=l[0].length,b=Object(s.a)({},r);if(console.log("[faiz:] === existingText",l),"insert-row-above"===o){l.splice(c.row,0,Array(d).fill(""));var f=Object(v.a)(a.path);f.splice(1,1,c.row+1),b={anchor:Object(s.a)(Object(s.a)({},b.anchor),{},{path:f}),focus:Object(s.a)(Object(s.a)({},b.focus),{},{path:f})}}else if("insert-row-below"===o)l.splice(c.row+1,0,Array(d).fill(""));else if("insert-column-above"===o){l=Array.from(l,(function(e){var t=Object(v.a)(e);return t.splice(c.column,0,""),t}));var h=Object(v.a)(a.path);h.splice(2,1,c.column+1),b={anchor:Object(s.a)(Object(s.a)({},b.anchor),{},{path:h}),focus:Object(s.a)(Object(s.a)({},b.focus),{},{path:h})}}else if("insert-column-below"===o)l=Array.from(l,(function(e){var t=Object(v.a)(e);return t.splice(c.column+1,0,""),t}));else if("delete-row"===o&&(null===(i=l)||void 0===i?void 0:i.length)>1)l.splice(c.row,1);else{if(!("delete-column"===o&&d>1))return console.error("[insert cells run error]: unsupport action or can not delete",o,d);l=Array.from(l,(function(e){var t=Object(v.a)(e);return t.splice(c.column,1),t}))}console.log("[faiz:] === xxxxx",l),n.removeTable();var j=k(l);u.h.insertNodes(n.editor,j,{at:t}),"delete-row"!==o&&"delete-column"!==o&&u.h.select(n.editor,b)},this.removeTable=function(){u.h.removeNodes(n.editor,{match:function(e){return!u.a.isEditor(e)&&u.b.isElement(e)&&"table"===e.type},mode:"highest"})},this.edit=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"insert-row-below",t=n.editor.selection;if(t&&u.f.isCollapsed(t)){var r=u.a.nodes(n.editor,{match:function(e){return!u.a.isEditor(e)&&u.b.isElement(e)&&"table"===e.type}}),o=Object(l.a)(r,1),i=o[0];if(i){var a=Object(l.a)(i,2),c=a[0],s=a[1];console.log("[faiz:] === path",c,s),n.insertCells(c,s,t,e)}}},this.editor=t},C=n(8),E=function(){var e=Object(d.c)(),t=new A(e),n=function(e,n){e.preventDefault(),t.edit(n)};return Object(C.jsxs)("div",{className:"mt-8 mb-2 space-x-2 bg-white inline-flex px-3 py-1 rounded-md shadow-sm",children:[Object(C.jsx)(f.a,{title:"insert row above",arrowPointAtCenter:!0,placement:"topLeft",children:Object(C.jsx)(h.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"insert-row-above")}})}),Object(C.jsx)(f.a,{title:"insert rowbelow",arrowPointAtCenter:!0,placement:"topLeft",children:Object(C.jsx)(j.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"insert-row-below")}})}),Object(C.jsx)(f.a,{title:"delete row",arrowPointAtCenter:!0,placement:"topLeft",children:Object(C.jsx)(m.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"delete-row")}})}),Object(C.jsx)("div",{className:"border-l border-gray-300"}),Object(C.jsx)(f.a,{title:"insert column above",arrowPointAtCenter:!0,placement:"topLeft",children:Object(C.jsx)(p.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"insert-column-above")}})}),Object(C.jsx)(f.a,{title:"insert column below",arrowPointAtCenter:!0,placement:"topLeft",children:Object(C.jsx)(w.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"insert-column-below")}})}),Object(C.jsx)(f.a,{title:"delete column",arrowPointAtCenter:!0,placement:"topLeft",children:Object(C.jsx)(O.a,{className:"text-xl cursor-pointer hover:opacity-70",onMouseDown:function(e){return n(e,"delete-column")}})})]})},N=(n(191),window.logseq),M=N.App,z=N.Editor,B=function(e){var t=e.attributes,n=e.children;switch(e.element.type){case"table":return Object(C.jsx)("table",{children:Object(C.jsx)("tbody",Object(s.a)(Object(s.a)({},t),{},{children:n}))});case"table-row":return Object(C.jsx)("tr",Object(s.a)(Object(s.a)({},t),{},{children:n}));case"table-cell":return Object(C.jsx)("td",Object(s.a)(Object(s.a)({},t),{},{children:n}));default:return Object(C.jsx)("p",Object(s.a)(Object(s.a)({},t),{},{children:n}))}},I=function(e){var t=e.initialTableContent,n=void 0===t?"|||\n|--|--|\n|||":t,o=e.blockId,i=Object(r.useState)([y(n)]),a=Object(l.a)(i,2),f=a[0],h=a[1];console.log("[faiz:] === createTableNode",y(n),n);var j=Object(r.useMemo)((function(){return b(Object(d.d)(Object(u.i)()))}),[]),m=Object(r.useCallback)((function(e){return Object(C.jsx)(B,Object(s.a)({},e))}),[]),p=function(){N.hideMainUI()};return Object(C.jsxs)("div",{className:"w-screen h-screen flex justify-center items-center",children:[Object(C.jsx)("div",{className:"w-screen h-screen absolute",style:{background:"rgba(0, 0, 0, .3)",zIndex:-1},onClick:p}),Object(C.jsxs)("div",{className:"w-2/3 h-1/2",children:[Object(C.jsxs)(d.b,{editor:j,value:f,onChange:h,children:[Object(C.jsx)(E,{}),Object(C.jsx)(d.a,{placeholder:"Write something",renderElement:m})]}),Object(C.jsxs)("div",{className:"mt-2 flex justify-end",children:[Object(C.jsx)(c.a,{className:"mr-1 rounded",onClick:p,children:"Cancel"}),Object(C.jsx)(c.a,{className:"rounded",type:"primary",onClick:function(){if(!o)return M.showMsg("uuid error");console.log("[faiz:] === onClickConfirm",o,f);var e=function(e){var t=Array.from(e.children,(function(e){var t=Array.from(e.children,(function(e){return e.children[0].text})).join("|");return"|".concat(t,"|")}));return t.splice(1,0,"|".concat(Array.from(e.children[0].children,(function(){return"--"})).join("|"),"|")),t.join("\n")}(f[0]);z.updateBlock(o,e).then((function(){M.showMsg("markdown table overwrite success"),N.hideMainUI()})).catch((function(e){M.showMsg("markdown table overwrite error",e)}))},children:"Confirm"})]})]})]})},D=window.logseq,T=D.Editor,q=D.App;D.ready().then((function(){D.provideStyle("\n    iframe#hayden_markdown_table.lsp-iframe-sandbox {\n      z-index: 10;\n    }\n  "),console.log("[faiz:] === markdown-table-editor-plugin loaded"),T.registerBlockContextMenuItem("woz-markdown-table-editor",(function(e){console.log("[faiz:] === woz-markdown-table-editor",e),T.getBlock(e.uuid).then((function(t){console.log("[faiz:] === block",t);var n=t.format,r=t.content;if("markdown"!==n)return q.showMsg("woz-markdown-table-editor only support markdown");L(r,e.uuid),D.showMainUI()}))}))}));var L=function(e,t){a.a.render(Object(C.jsx)(o.a.StrictMode,{children:Object(C.jsx)(I,{initialTableContent:e,blockId:t})}),document.getElementById("root"))}}},[[192,1,2]]]);
//# sourceMappingURL=main.74446859.chunk.js.map